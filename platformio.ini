; PlatformIO configuration for configManager library development and testing
; Enhanced to follow the BasePacket embedded test standard (production + test envs)
; Place this in lib/abstractClasses/config/

[platformio]
default_envs = seeed_xiao_esp32s3
extra_configs = platformio.unity.ini

[env]
framework = arduino
lib_deps =
    bblanchon/ArduinoJson@^7.4.1
monitor_speed = 115200

; Base production environment (Seeed XIAO ESP32S3 LittleFS)
[env:seeed_xiao_esp32s3]
platform = espressif32
board = seeed_xiao_esp32s3
build_flags =
    -std=gnu++11
    -DUSE_LITTLEFS
    -Isrc
    -Isrc/interface

; Embedded test environment (runs full in-firmware tests)
[env:seeed_xiao_esp32s3_tests]
platform = espressif32
board = seeed_xiao_esp32s3
build_flags =
    -std=gnu++11
    -DUSE_LITTLEFS
    -DRUN_EMBEDDED_TESTS           ; Enables testRunner.cpp
    -DTESTBENCH                    ; Enables extended internal test APIs
    -Isrc
    -Isrc/interface
    -Itest                         ; Allow including headers from /test

[env:esp32s3_littlefs]
platform = espressif32
board = seeed_xiao_esp32s3
framework = arduino
lib_deps =
    bblanchon/ArduinoJson@^7.4.1
build_flags =
    -DUSE_LITTLEFS
    -Isrc

[env:esp32s3_spiffs]
platform = espressif32
board = seeed_xiao_esp32s3
framework = arduino
lib_deps =
    bblanchon/ArduinoJson@^7.4.1
build_flags =
    -Isrc

[env:esp32_littlefs]
platform = espressif32
board = esp32dev
framework = arduino
lib_deps =
    bblanchon/ArduinoJson@^7.4.1
build_flags =
    -DUSE_LITTLEFS
    -Isrc

[env:esp32_spiffs]
platform = espressif32
board = esp32dev
framework = arduino
lib_deps =
    bblanchon/ArduinoJson@^7.4.1
build_flags =
    -Isrc

[env:esp8266_littlefs]
platform = espressif8266
board = nodemcuv2
framework = arduino
lib_deps =
    bblanchon/ArduinoJson@^7.4.1
build_flags =
    -DUSE_LITTLEFS
    -Isrc

[env:esp8266_spiffs]
platform = espressif8266
board = nodemcuv2
framework = arduino
lib_deps =
    bblanchon/ArduinoJson@^7.4.1
build_flags =
    -Isrc
    -Isrc/interface

; Native host test environment (no hardware) - requires compatibility layer
[env:native]
platform = native
framework = 
build_flags =
    -std=gnu++17
    -D CONFIGMGR_NATIVE
    -Isrc
    -Isrc/interface
    -Isrc/compat
    -Itest
lib_deps =
    
test_ignore = *


; ---------------------------------------------------------------------------
; Usage:
;   Production build:
;       pio run -e seeed_xiao_esp32s3
;       pio upload -e seeed_xiao_esp32s3
;   Embedded test build (runs tests automatically on boot):
;       pio run -e seeed_xiao_esp32s3_tests
;       pio upload -e seeed_xiao_esp32s3_tests
;       pio device monitor -e seeed_xiao_esp32s3_tests
; ---------------------------------------------------------------------------
